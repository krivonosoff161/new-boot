{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - Enhanced Trading System v3.0{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
        <div class="alert alert-warning">
            <h4>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h4>
            <p>–í–∞—à–∞ —Ä–æ–ª—å: <strong>{{ user.role }}</strong></p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="loadUsers()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                <div id="users-list" class="mt-3"></div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
            </div>
            <div class="card-body">
                <p>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: <span class="badge bg-success">–†–∞–±–æ—Ç–∞–µ—Ç</span></p>
                <p>–í–µ—Ä—Å–∏—è: <strong>v3.0.0</strong></p>
                <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: <span class="badge bg-success">–ü–æ–¥–∫–ª—é—á–µ–Ω–∞</span></p>
            </div>
        </div>
    </div>
</div>

<script>
function loadUsers() {
    fetch('/api/users')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
                return;
            }
            
            let html = '<table class="table table-striped"><thead><tr><th>ID</th><th>–ò–º—è</th><th>Email</th><th>–†–æ–ª—å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
            
            data.users.forEach(user => {
                html += `<tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="badge bg-${user.role === 'super_admin' ? 'danger' : 'primary'}">${user.role}</span></td>
                    <td>
                        ${user.role !== 'super_admin' ? `<button class="btn btn-sm btn-warning" onclick="promoteUser(${user.id})">–°–¥–µ–ª–∞—Ç—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–º</button>` : ''}
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            document.getElementById('users-list').innerHTML = html;
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
        });
}

function promoteUser(userId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–º?')) {
        fetch(`/api/promote/${userId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –ø–æ–≤—ã—à–µ–Ω –¥–æ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞!');
                    loadUsers(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            });
    }
}
</script>
{% endblock %}






