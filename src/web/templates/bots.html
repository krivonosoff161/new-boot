{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏ - Enhanced Trading System v3.0{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-12">
        <h1 class="mb-4">ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –±–æ—Ç–∞–º–∏</h1>
        <div class="alert alert-info">
            <h4>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏!</h4>
            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å, –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –±–æ—Ç–∞–º–∏.</p>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
            <div class="card-header">
                <h5>üéØ Grid Trading Bot</h5>
                </div>
                <div class="card-body">
                <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –ø–æ —Å–µ—Ç–∫–µ —Å –∑–æ–Ω–∞–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∏—Å–∫–∞–º–∏</p>
                <ul class="list-unstyled">
                    <li>‚úÖ –ú—É–ª—å—Ç–∏-–∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</li>
                    <li>‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–µ—Ç–∫–∏</li>
                    <li>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏</li>
                </ul>
                <button class="btn btn-primary" onclick="createBot('grid')">–°–æ–∑–¥–∞—Ç—å Grid Bot</button>
                        </div>
                        </div>
                    </div>
        <div class="col-md-6">
            <div class="card">
            <div class="card-header">
                <h5>‚ö° Scalp Trading Bot</h5>
                        </div>
                <div class="card-body">
                <p>–ë—ã—Å—Ç—Ä–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</p>
                <ul class="list-unstyled">
                    <li>‚úÖ ML —Å–∏–≥–Ω–∞–ª—ã</li>
                    <li>‚úÖ –ë—ã—Å—Ç—Ä—ã–µ —Å–¥–µ–ª–∫–∏</li>
                    <li>‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞</li>
                </ul>
                <button class="btn btn-primary" onclick="createBot('scalp')">–°–æ–∑–¥–∞—Ç—å Scalp Bot</button>
                        </div>
                        </div>
                        </div>
                    </div>
                    
                    
                    <div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5>üìä –ú–æ–∏ –±–æ—Ç—ã</h5>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-info" onclick="showBotInfo('grid')" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Grid Bot">
                        <i class="fas fa-info-circle"></i> Grid
                        </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="showBotInfo('scalp')" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Scalp Bot">
                        <i class="fas fa-info-circle"></i> Scalp
                        </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="event.preventDefault(); window.refreshBots(); return false;">–û–±–Ω–æ–≤–∏—Ç—å</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="window.updateBotsData()" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="forceStopAllBots()" title="–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã">
                        <i class="fas fa-stop"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
                        </button>
                        </div>
                        </div>
            <div class="card-body">
                <div id="bots-list">
                        <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤...</p>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ -->
<div class="modal fade" id="createBotModal" tabindex="-1" aria-labelledby="createBotModalTitle" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createBotModalTitle">–°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
            <div class="modal-body">
                <form id="createBotForm">
                    <div class="mb-3">
                        <label class="form-label" for="botType">–¢–∏–ø –±–æ—Ç–∞:</label>
                        <input type="text" class="form-control" id="botType" readonly>
                </div>
                    <div class="mb-3">
                        <label class="form-label" for="botName">–ù–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <input type="text" class="form-control" id="botName" placeholder="–ú–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="botDescription">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <textarea class="form-control" id="botDescription" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏..."></textarea>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã -->
                    <div class="mb-3">
                        <label class="form-label" for="modeDemo">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</label>
                    <div class="row">
        <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="botMode" id="modeDemo" value="demo" checked>
                                    <label class="form-check-label" for="modeDemo">
                                        <i class="fas fa-gamepad text-warning"></i> <strong>–î–µ–º–æ —Ä–µ–∂–∏–º</strong>
                                        <br><small class="text-muted">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤</small>
                        </label>
                    </div>
                </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="botMode" id="modeLive" value="live">
                                    <label class="form-check-label" for="modeLive">
                                        <i class="fas fa-coins text-success"></i> <strong>–†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</strong>
                                        <br><small class="text-muted">–¢–æ—Ä–≥–æ–≤–ª—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä API –∫–ª—é—á–µ–π -->
                    <div class="mb-3">
                        <label class="form-label" for="apiKeySelect">API –∫–ª—é—á–∏ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏:</label>
                        <select class="form-select" id="apiKeySelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ API –∫–ª—é—á–∏...</option>
                        </select>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i> 
                            –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ -->
                    <div id="liveModeWarning" class="alert alert-warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í—ã –≤—ã–±—Ä–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏. 
                        –ë–æ—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ —Ä–∏—Å–∫–∏.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="submitCreateBot()">–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞</button>
            </div>
        </div>
                        </div>
                    </div>
                    
                    
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Ä —Å –±–∏—Ä–∂–∏ -->
<div class="modal fade" id="exchangePairsModal" tabindex="-1" aria-labelledby="exchangePairsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exchangePairsModalLabel">
                    <i class="fas fa-exchange-alt"></i> –¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã —Å –±–∏—Ä–∂–∏
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fas fa-search"></i>
                        </span>
                        <label for="pairSearch" class="visually-hidden">–ü–æ–∏—Å–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä</label>
                        <input type="text" class="form-control" id="pairSearch" 
                               placeholder="–ü–æ–∏—Å–∫ –ø–∞—Ä..." onkeyup="filterExchangePairs()">
                    </div>
                </div>
                <div id="exchangePairsList" style="max-height: 400px; overflow-y: auto;">
                    <div class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä—ã —Å –±–∏—Ä–∂–∏...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-info" onclick="showConsoleOutput()">
                    <i class="fas fa-terminal"></i> –ö–æ–Ω—Å–æ–ª—å
                </button>
                <button type="button" class="btn btn-primary" onclick="refreshBotDetails()">
                    <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
                <button type="button" class="btn btn-primary" onclick="addSelectedPairs()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>
        </div>
    </div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞ -->
<div class="modal fade" id="botDetailsModal" tabindex="-1" aria-labelledby="botDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="botDetailsModalLabel">
                    <i class="fas fa-robot"></i> –î–µ—Ç–∞–ª–∏ –±–æ—Ç–∞
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å" onclick="closeBotDetailsModal()"></button>
            </div>
            <div class="modal-body">
                <div id="botDetailsContent">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-info" onclick="showConsoleOutput()">
                    <i class="fas fa-terminal"></i> –ö–æ–Ω—Å–æ–ª—å
                </button>
                <button type="button" class="btn btn-primary" onclick="refreshBotDetails()">
                    <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
                <button type="button" class="btn btn-info" onclick="showConsoleOutput()">
                    <i class="fas fa-terminal"></i> –ö–æ–Ω—Å–æ–ª—å
                </button>
                <button type="button" class="btn btn-primary" onclick="refreshBotDetails()">
                    <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ -->
<div class="modal fade" id="consoleModal" tabindex="-1" aria-labelledby="consoleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="consoleModalLabel">
                    <i class="fas fa-terminal"></i> –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –±–æ—Ç–∞
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body p-0">
                <div class="console-container" style="height: 500px; overflow-y: auto; background-color: #1e1e1e; color: #00ff00; font-family: 'Courier New', monospace; padding: 15px;">
                    <div id="consoleOutput">
                        <div class="console-line">üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å–æ–ª–∏...</div>
                        <div class="console-line">üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-dark">
                <button type="button" class="btn btn-success" onclick="startConsoleMonitoring()">
                    <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                </button>
                <button type="button" class="btn btn-warning" onclick="pauseConsoleMonitoring()">
                    <i class="fas fa-pause"></i> –ü–∞—É–∑–∞
                </button>
                <button type="button" class="btn btn-danger" onclick="clearConsole()">
                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

<script>
console.log('üìú –°–∫—Ä–∏–ø—Ç bots.html –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');

// –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
window.updateBotsData = function() {
    console.log('üîÑ updateBotsData –≤—ã–∑–≤–∞–Ω–∞!');
    console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–æ–≤...');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
    const botsContainer = document.getElementById('bots-list');
    if (botsContainer) {
        botsContainer.innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤...</p>
            </div>
        `;
    }
    
    fetch('/api/bots/status', {
        method: 'GET',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
        }
    })
        .then(response => {
            console.log('üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
            if (response.status === 302) {
                console.log('‚ùå –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞');
                window.location.href = '/login';
                return;
            }
            return response.json();
        })
        .then(data => {
            console.log('üìä –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', data);
            if (data && data.success && data.bots) {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ –±–æ—Ç–æ–≤:', data.bots.length);
                window.renderBotsList(data.bots);
            } else {
                console.log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–æ—Ç–∞—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞ API');
                window.renderBotsList([]);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–æ–≤:', error);
            const botsContainer = document.getElementById('bots-list');
            if (botsContainer) {
                botsContainer.innerHTML = `
                    <div class="alert alert-danger text-center">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–æ–≤</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
                        <button class="btn btn-primary" onclick="window.updateBotsData()">
                            <i class="fas fa-sync-alt"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            }
        });
};

window.renderBotsList = function(bots) {
    console.log('üîÑ renderBotsList –≤—ã–∑–≤–∞–Ω–∞ —Å –±–æ—Ç–∞–º–∏:', bots);
    const botsContainer = document.getElementById('bots-list');
    if (!botsContainer) {
        console.log('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä bots-list –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    if (bots.length === 0) {
        botsContainer.innerHTML = `
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <i class="fas fa-robot fa-3x mb-3"></i>
                    <h4>–ù–µ—Ç –±–æ—Ç–æ–≤</h4>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏</p>
                    <button class="btn btn-primary" onclick="showCreateBotModal()">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
                    </button>
                </div>
            </div>
        `;
        return;
    }
    
    let html = '';
    bots.forEach(bot => {
        const statusClass = bot.status === 'running' ? 'success' : 
                           bot.status === 'stopped' ? 'danger' : 'warning';
        const statusText = bot.status === 'running' ? '–ó–∞–ø—É—â–µ–Ω' : 
                          bot.status === 'stopped' ? '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–°–æ–∑–¥–∞–Ω';
        
        html += `
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">${bot.name}</h5>
                        <span class="badge bg-${statusClass}">${statusText}</span>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            <strong>–¢–∏–ø:</strong> ${bot.type === 'grid' ? 'Grid Bot' : 'Scalp Bot'}<br>
                            <strong>ID:</strong> ${bot.id}<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> ${bot.status}
                        </p>
                    </div>
                    <div class="card-footer">
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-outline-primary btn-sm" onclick="showBotDetails('${bot.id}')">
                                <i class="fas fa-info-circle"></i> –î–µ—Ç–∞–ª–∏
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="startBot('${bot.id}')">
                                <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="stopBot('${bot.id}')">
                                <i class="fas fa-stop"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="deleteBot('${bot.id}')" title="–£–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    botsContainer.innerHTML = html;
    console.log('‚úÖ –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –±–æ—Ç–æ–≤:', bots.length);
};

console.log('‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã');
console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏:');
console.log('showBotDetails:', typeof window.showBotDetails);
console.log('loadBotDetails:', typeof window.loadBotDetails);
console.log('updateBotsData:', typeof window.updateBotsData);
console.log('renderBotsList:', typeof window.renderBotsList);

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é createBot –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
window.createBot = function(botType) {
    console.log('createBot –≤—ã–∑–≤–∞–Ω–∞ —Å —Ç–∏–ø–æ–º:', botType);
    
    try {
    document.getElementById('botType').value = botType;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞
        let botName = '';
        switch(botType) {
            case 'grid':
                botName = 'Grid Bot';
                break;
            case 'scalp':
                botName = 'Scalp Bot';
                break;
            default:
                botName = 'Trading Bot';
        }
        
        document.getElementById('createBotModalTitle').textContent = `–°–æ–∑–¥–∞–Ω–∏–µ ${botName}`;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ API –∫–ª—é—á–∏
    loadAvailableApiKeys();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
    setupModeHandlers();
    
    const modal = new bootstrap.Modal(document.getElementById('createBotModal'));
    modal.show();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤ createBot:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ' + error.message);
    }
}

window.loadAvailableApiKeys = function() {
    fetch('/api/bots/available-keys')
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('apiKeySelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ API –∫–ª—é—á–∏...</option>';
            
            if (data.success && data.keys && data.keys.length > 0) {
                data.keys.forEach(key => {
                        const option = document.createElement('option');
                    option.value = key.key_id;
                    option.textContent = key.display_name;
                        select.appendChild(option);
                });
                
                if (select.children.length === 1) {
                    select.innerHTML = '<option value="">–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö API –∫–ª—é—á–µ–π</option>';
                    select.disabled = true;
                } else {
                    // –£–±–∏—Ä–∞–µ–º disabled, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á–∏
                    select.disabled = false;
                    console.log('API –∫–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, —Å–µ–ª–µ–∫—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                }
            } else {
                select.innerHTML = '<option value="">–ù–µ—Ç API –∫–ª—é—á–µ–π. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "API –ö–ª—é—á–∏"</option>';
                select.disabled = true;
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ API –∫–ª—é—á–µ–π:', error);
            const select = document.getElementById('apiKeySelect');
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–µ–π</option>';
            select.disabled = true;
        });
}

window.setupModeHandlers = function() {
    const demoMode = document.getElementById('modeDemo');
    const liveMode = document.getElementById('modeLive');
    const warning = document.getElementById('liveModeWarning');
    
    demoMode.addEventListener('change', function() {
        if (this.checked) {
            warning.style.display = 'none';
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –¥–ª—è –¥–µ–º–æ —Ä–µ–∂–∏–º–∞
            updateApiKeysForMode('demo');
        }
    });
    
    liveMode.addEventListener('change', function() {
        if (this.checked) {
            warning.style.display = 'block';
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            updateApiKeysForMode('live');
        }
    });
}

window.updateApiKeysForMode = function(mode) {
    fetch('/api/bots/available-keys')
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('apiKeySelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ API –∫–ª—é—á–∏...</option>';
            
            if (data.success && data.keys && data.keys.length > 0) {
                data.keys.forEach(key => {
                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–ª—é—á–∏ –ø–æ —Ä–µ–∂–∏–º—É
                        const keyMode = key.mode === 'sandbox' ? 'demo' : 'live';
                        if (keyMode === mode) {
                            const option = document.createElement('option');
                        option.value = key.key_id;
                        option.textContent = key.display_name;
                            select.appendChild(option);
                    }
                });
                
                if (select.children.length === 1) {
                    select.innerHTML = `<option value="">–ù–µ—Ç ${mode === 'demo' ? '–¥–µ–º–æ' : '—Ä–µ–∞–ª—å–Ω—ã—Ö'} API –∫–ª—é—á–µ–π</option>`;
                    select.disabled = true;
                } else {
                    select.disabled = false;
                }
            } else {
                select.innerHTML = '<option value="">–ù–µ—Ç API –∫–ª—é—á–µ–π</option>';
                select.disabled = true;
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ API –∫–ª—é—á–µ–π:', error);
        });
}

window.submitCreateBot = function() {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
    const submitButton = document.querySelector('#createBotModal .btn-success');
    if (submitButton && submitButton.disabled) {
        console.log('‚ö†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...');
        return;
    }
    
    const botType = document.getElementById('botType').value;
    const botName = document.getElementById('botName').value;
    const botDescription = document.getElementById('botDescription').value;
    const botMode = document.querySelector('input[name="botMode"]:checked').value;
    const apiKeyId = document.getElementById('apiKeySelect').value;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!apiKeyId) {
        showAlert('danger', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ API –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞');
        return;
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ–∑–¥–∞–µ–º...';
    }
    
    const config = {
        name: botName || `–ú–æ–π ${botType} –±–æ—Ç`,
        description: botDescription,
        created_by: '{{ session.username }}',
        mode: botMode
    };
    
    fetch('/api/bots/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            botType: botType,
            botName: document.getElementById('botName').value || `${botType.toUpperCase()} Bot ${Date.now()}`,
            apiKeyId: apiKeyId,
            mode: botMode,
            tradingPairs: [],
            settings: config
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞:', data);
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('createBotModal')).hide();
            showAlert('success', `–ë–æ—Ç ${data.bot_id} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {
                refreshBots();
            }, 500);
        } else {
            showAlert('danger', '–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showAlert('danger', '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞');
    })
    .finally(() => {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
        const submitButton = document.querySelector('#createBotModal .btn-success');
        if (submitButton) {
            submitButton.disabled = false;
            submitButton.innerHTML = '<i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞';
        }
    });
}

// –°—Ç–∞—Ä—ã–µ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ startBot, stopBot, deleteBot —É–¥–∞–ª–µ–Ω—ã
// –ü–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–∏–∂–µ (—Å—Ç—Ä–æ–∫–∏ 1636+)

window.updateBotsList = function(bots) {
    console.log('üîÑ updateBotsList –≤—ã–∑–≤–∞–Ω–∞ —Å –±–æ—Ç–∞–º–∏:', bots);
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–æ—Ç–æ–≤ –≤ DOM
    const botsList = document.getElementById('bots-list');
    
    if (!bots || bots.length === 0) {
        botsList.innerHTML = `
            <div class="text-center text-muted py-5">
                <i class="fas fa-robot fa-3x mb-3"></i>
                <h5>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–æ—Ç–æ–≤</h5>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏</p>
                <button class="btn btn-primary" onclick="createBot('grid')">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å Grid Bot
                </button>
            </div>
        `;
        return;
    }
    
    let botsHtml = '';
    bots.forEach(bot => {
        const statusColor = {
            'running': 'success',
            'stopped': 'secondary', 
            'created': 'info',
            'error': 'danger'
        }[bot.status] || 'secondary';
        
        const statusIcon = {
            'running': 'play',
            'stopped': 'stop',
            'created': 'plus',
            'error': 'exclamation-triangle'
        }[bot.status] || 'question';
        
        botsHtml += `
            <div class="card mb-3" id="bot-${bot.id}">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <h6>${bot.type === 'grid' ? 'üéØ Grid Bot' : '‚ö° Scalp Bot'}</h6>
                            <small class="text-muted">${bot.bot_name || bot.id}</small>
                        </div>
                        <div class="col-md-2">
                            <span class="badge bg-${statusColor}">
                                <i class="fas fa-${statusIcon}"></i> ${bot.status}
                            </span>
                        </div>
                        <div class="col-md-2">
                            <span class="badge bg-${bot.mode === 'demo' ? 'warning' : 'success'}">
                                ${bot.mode === 'demo' ? 'Demo' : 'Live'}
                            </span>
                        </div>
                        <div class="col-md-2">
                            <small class="text-muted">${bot.created_at ? new Date(bot.created_at).toLocaleDateString() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</small>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-info" onclick="showBotDetails('${bot.id}')">
                                    <i class="fas fa-info-circle"></i> –î–µ—Ç–∞–ª–∏
                        </button>
                                <button class="btn btn-sm btn-success" onclick="startBot('${bot.id}')">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteBot('${bot.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    botsList.innerHTML = botsHtml;
    console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤: ${bots.length} –±–æ—Ç–æ–≤`);
}

// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è refreshBots —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
window.loadBotDetailsData = function(botId) {
    const content = document.getElementById('botDetailsContent');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
    content.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ...</p>
        </div>
    `;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    Promise.all([
        fetch(`/api/bots/${botId}/details`, {
            method: 'GET',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' }
        }).then(response => response.json()),
        fetch(`/api/bots/${botId}/logs`, {
            method: 'GET',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' }
        }).then(response => response.json()).catch(() => ({ success: false, logs: [] }))
    ])
    .then(([detailsData, logsData]) => {
        console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç API:', detailsData);
        console.log('–ü–æ–ª—É—á–µ–Ω—ã –ª–æ–≥–∏ –æ—Ç API:', logsData);
        
        if (detailsData.success) {
            // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
            let botData = detailsData.bot || detailsData.bot_details || detailsData;
            console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞:', botData);
            
            if (botData) {
                // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏ –∫ –¥–∞–Ω–Ω—ã–º –±–æ—Ç–∞
                botData.logs = logsData.success ? logsData.logs : [];
                renderBotDetails(botData, detailsData.charts, detailsData.system_metrics, botData.logs);
        } else {
                console.error('–î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ API');
                content.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        –î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û—Ç–≤–µ—Ç API: <pre>${JSON.stringify(detailsData, null, 2)}</pre>
                    </div>
                `;
            }
        } else {
            console.error('API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', detailsData);
            content.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    –û—à–∏–±–∫–∞ API: ${detailsData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞:', error);
        content.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞
            </div>
        `;
    });

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞
window.renderBotDetails = function(botData, charts, metrics, logs) {
    console.log('–§—É–Ω–∫—Ü–∏—è renderBotDetails –≤—ã–∑–≤–∞–Ω–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:', botData);
    
    const content = document.getElementById('botDetailsContent');
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    const safeBot = {
        basic_info: botData.basic_info || {
            name: botData.bot_name || botData.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–æ—Ç',
            type: botData.bot_type || botData.type || 'grid',
            status: botData.status || 'unknown',
            mode: botData.mode || 'demo',
            api_key_id: botData.api_key_id || '–ù–µ —É–∫–∞–∑–∞–Ω',
            created_at: botData.created_at || new Date().toISOString(),
            id: botData.bot_id || botData.id || 'unknown'
        },
        trading_settings: botData.trading_settings || {
            capital: 1000,
            risk_level: 'medium',
            max_pairs: 8
        },
        performance: botData.performance || {
            total_trades: 0,
            win_rate: 0,
            profit_loss: 0
        },
        balance_info: botData.balance_info || {
            allocated_capital: 1000,
            available_capital: 1000,
            used_capital: 0,
            profit_loss: 0
        },
        risk_management: botData.risk_management || {
            max_risk_per_trade: 2.0,
            total_risk_limit: 10.0,
            current_risk: 0.0
        },
        automation_settings: botData.automation_settings || {
            auto_rebalance: true,
            auto_pair_selection: true,
            auto_risk_adjustment: true,
            capital_distribution_mode: 'smart'
        },
        trading_pairs: botData.trading_pairs || ['BTC/USDT']
    };
    
    console.log('–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞:', safeBot);
    
    // –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ò –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –û–¢–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
    const modalElement = document.getElementById('botDetailsModal');
    console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ DOM:', !!modalElement);
    console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–∏–º–æ–µ –î–û:', modalElement ? modalElement.style.display : '—ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
    console.log('–ö–ª–∞—Å—Å—ã –î–û:', modalElement ? modalElement.className : '—ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
    
    // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –û–¢–ö–†–´–í–ê–ï–ú –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ó–î–ï–°–¨
    if (modalElement) {
        console.log('üöÄ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –û–¢–ö–†–´–í–ê–ï–ú –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û');
        
        modalElement.style.display = 'block';
        modalElement.classList.add('show');
        modalElement.classList.add('d-block');
        modalElement.setAttribute('aria-hidden', 'false');
        document.body.classList.add('modal-open');
        
        // –î–æ–±–∞–≤–ª—è–µ–º backdrop
        let backdrop = document.getElementById('modal-backdrop-force');
        if (!backdrop) {
            backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop fade show';
            backdrop.id = 'modal-backdrop-force';
            document.body.appendChild(backdrop);
        }
        
        console.log('‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –û–¢–ö–†–´–¢–û!');
        console.log('üîç –ö–ª–∞—Å—Å—ã –ü–û–°–õ–ï:', modalElement.className);
        console.log('üîç Display –ü–û–°–õ–ï:', modalElement.style.display);
    }
    
    // –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –í–°–¢–ê–í–ö–ò HTML
    console.log('üîç –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ HTML:', content);
    console.log('üîç HTML –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –î–û –≤—Å—Ç–∞–≤–∫–∏:', content ? content.innerHTML : '–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
    
    const newHTML = `
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º -->
        <ul class="nav nav-tabs" id="botDetailsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                    <i class="fas fa-info-circle"></i> –û–±–∑–æ—Ä
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">
                    <i class="fas fa-chart-line"></i> –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation" type="button" role="tab">
                    <i class="fas fa-robot"></i> –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab">
                    <i class="fas fa-file-text"></i> –õ–æ–≥–∏
                </button>
            </li>
        </ul>
        
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content" id="botDetailsTabContent">
            <!-- –í–∫–ª–∞–¥–∫–∞ –û–±–∑–æ—Ä -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-info"></i> –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> ${safeBot.basic_info.name}</p>
                                <p><strong>–¢–∏–ø:</strong> ${safeBot.basic_info.type.toUpperCase()} Bot</p>
                                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                                    <span class="badge bg-${safeBot.basic_info.status === 'running' ? 'success' : 'secondary'}">
                                        ${safeBot.basic_info.status}
                                    </span>
                                </p>
                                <p><strong>–†–µ–∂–∏–º:</strong> 
                                    <span class="badge bg-${safeBot.basic_info.mode === 'demo' ? 'warning' : 'success'}">
                                        ${safeBot.basic_info.mode === 'demo' ? 'Demo' : 'Live'}
                                    </span>
                                </p>
                                <p><strong>API –∫–ª—é—á:</strong> ${safeBot.basic_info.api_key || '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω'}</p>
                                <p><strong>–°–æ–∑–¥–∞–Ω:</strong> ${new Date(safeBot.basic_info.created_at).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-wallet"></i> –ë–∞–ª–∞–Ω—Å –∏ –∫–∞–ø–∏—Ç–∞–ª</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–í—ã–¥–µ–ª–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª:</strong> $${safeBot.balance_info.allocated_capital || 0}</p>
                                <p><strong>–î–æ—Å—Ç—É–ø–Ω—ã–π:</strong> $${safeBot.balance_info.free_balance || 0}</p>
                                <p><strong>–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π:</strong> $${safeBot.balance_info.used_balance || 0}</p>
                                <p><strong>P&L:</strong> 
                                    <span class="text-${(safeBot.balance_info.profit_loss || 0) >= 0 ? 'success' : 'danger'}">
                                        $${safeBot.balance_info.profit_loss || 0}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-cog"></i> –¢–æ—Ä–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">–ö–∞–ø–∏—Ç–∞–ª:</label>
                                    <input type="number" class="form-control" value="${safeBot.trading_settings.capital}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:</label>
                                    <select class="form-select">
                                        <option value="low" ${safeBot.trading_settings.risk_level === 'low' ? 'selected' : ''}>–ù–∏–∑–∫–∏–π</option>
                                        <option value="medium" ${safeBot.trading_settings.risk_level === 'medium' ? 'selected' : ''}>–°—Ä–µ–¥–Ω–∏–π</option>
                                        <option value="high" ${safeBot.trading_settings.risk_level === 'high' ? 'selected' : ''}>–í—ã—Å–æ–∫–∏–π</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä:</label>
                                    <input type="number" class="form-control" value="${safeBot.trading_settings.max_pairs}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-shield-alt"></i> –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–ú–∞–∫—Å. —Ä–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É:</strong> ${safeBot.risk_management.max_risk_per_trade}%</p>
                                <p><strong>–û–±—â–∏–π –ª–∏–º–∏—Ç —Ä–∏—Å–∫–∞:</strong> ${safeBot.risk_management.total_risk_limit}%</p>
                                <p><strong>–¢–µ–∫—É—â–∏–π —Ä–∏—Å–∫:</strong> ${safeBot.risk_management.current_risk}%</p>
                                <div class="progress">
                                    <div class="progress-bar bg-${safeBot.risk_management.current_risk > 7 ? 'danger' : 'success'}" 
                                         style="width: ${(safeBot.risk_management.current_risk / safeBot.risk_management.total_risk_limit) * 100}%">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
            <div class="tab-pane fade" id="performance" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="text-primary">${safeBot.performance.total_trades}</h5>
                                <p class="mb-0">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="text-success">${safeBot.performance.win_rate}%</h5>
                                <p class="mb-0">–í–∏–Ω—Ä–µ–π—Ç</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="text-${safeBot.performance.profit_loss >= 0 ? 'success' : 'danger'}">
                                    $${safeBot.performance.profit_loss}
                                </h5>
                                <p class="mb-0">P&L</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-chart-line"></i> –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–±—ã–ª–∏</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="profitChart" width="400" height="200"></canvas>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="updateLiveChart('${safeBot.basic_info.id}')">
                                        <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="loadRealPerformance('${safeBot.basic_info.id}')">
                                        <i class="fas fa-chart-bar"></i> –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è -->
            <div class="tab-pane fade" id="automation" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-robot"></i> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoRebalance" ${safeBot.automation_settings.auto_rebalance ? 'checked' : ''} 
                                           onchange="toggleAutomation('${safeBot.basic_info.id}', 'auto_rebalance', this.checked)">
                                    <label class="form-check-label" for="autoRebalance">
                                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
                                    </label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoPairSelection" ${safeBot.automation_settings.auto_pair_selection ? 'checked' : ''} 
                                           onchange="toggleAutomation('${safeBot.basic_info.id}', 'auto_pair_selection', this.checked)">
                                    <label class="form-check-label" for="autoPairSelection">
                                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–∞—Ä
                                    </label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoRiskAdjustment" ${safeBot.automation_settings.auto_risk_adjustment ? 'checked' : ''} 
                                           onchange="toggleAutomation('${safeBot.basic_info.id}', 'auto_risk_adjustment', this.checked)">
                                    <label class="form-check-label" for="autoRiskAdjustment">
                                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∏—Å–∫–∞
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-balance-scale"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–†–µ–∂–∏–º:</strong> ${safeBot.automation_settings.capital_distribution_mode}</p>
                                <div class="mb-3">
                                    <label class="form-label">–¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã:</label>
                                    <div class="badge-container">
                                        ${(safeBot.trading_pairs || []).map(pair => `<span class="badge bg-primary me-1">${pair}</span>`).join('')}
                                    </div>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" onclick="manageTradingPairs('${safeBot.basic_info.id}')">
                                    <i class="fas fa-edit"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –õ–æ–≥–∏ -->
            <div class="tab-pane fade" id="logs" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-file-text"></i> –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h6>
                            </div>
                            <div class="card-body">
                                <div class="log-container" style="max-height: 400px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; border-radius: 5px;">
                                    ${(logs || []).length > 0 ? (logs || []).map(log => {
                                        // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –ª–æ–≥–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —É—Ä–æ–≤–Ω—è
                                        const logMatch = log.match(/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) \| (\w+) \| .* - (.+)$/);
                                        if (logMatch) {
                                            const [, time, level, message] = logMatch;
                                            const levelClass = level === 'ERROR' ? 'danger' : level === 'WARNING' ? 'warning' : 'info';
                                            return `
                                                <div class="log-entry mb-2 p-2 border rounded" style="background-color: white;">
                                                    <small class="text-muted">${time}</small>
                                                    <span class="badge bg-${levelClass} ms-2">${level}</span>
                                                    <div style="margin-top: 5px; font-family: monospace; font-size: 0.9em;">${message}</div>
                                                </div>
                                            `;
                                        } else {
                                            return `
                                                <div class="log-entry mb-2 p-2 border rounded" style="background-color: white;">
                                                    <div style="font-family: monospace; font-size: 0.9em;">${log}</div>
                                                </div>
                                            `;
                                        }
                                    }).join('') : `
                                        <div class="text-center text-muted py-3">
                                            <i class="fas fa-file-text fa-2x mb-2"></i>
                                            <p>–õ–æ–≥–∏ –±–æ—Ç–∞ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                                            <small>–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞</small>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –í–°–¢–ê–í–õ–Ø–ï–ú HTML –° –î–ò–ê–ì–ù–û–°–¢–ò–ö–û–ô
    console.log('üìù –í—Å—Ç–∞–≤–ª—è–µ–º HTML –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä...');
    console.log('üìè –†–∞–∑–º–µ—Ä HTML:', newHTML.length, '—Å–∏–º–≤–æ–ª–æ–≤');
    
    content.innerHTML = newHTML;
    
    console.log('‚úÖ HTML –í–°–¢–ê–í–õ–ï–ù!');
    console.log('üîç HTML –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ü–û–°–õ–ï –≤—Å—Ç–∞–≤–∫–∏ (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤):', content.innerHTML.substring(0, 200));
    console.log('üîç –ï—Å—Ç—å –ª–∏ –≤–∫–ª–∞–¥–∫–∏ –≤ DOM:', !!document.getElementById('botDetailsTabs'));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
window.closeBotDetailsModal = function() {
    const modalElement = document.getElementById('botDetailsModal');
    const backdrop = document.getElementById('modal-backdrop-force');
    
    if (modalElement) {
        modalElement.style.display = 'none';
        modalElement.classList.remove('show');
        modalElement.classList.remove('d-block');
        modalElement.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');
    }
    
    if (backdrop) {
        backdrop.remove();
    }
    
    console.log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modalElement = document.getElementById('botDetailsModal');
        if (modalElement && modalElement.style.display === 'block') {
            closeBotDetailsModal();
        }
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
function loadRealPerformance(botId) {
    console.log('üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ—Ç–∞:', botId);
    
    fetch(`/api/bots/${botId}/performance`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const performance = data.performance;
            console.log('‚úÖ –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:', performance);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            updatePerformanceDisplay(performance, data.real_data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showAlert('success', `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ ${data.real_data ? '(—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)' : '(—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)'}`);
        } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:', data.error);
            showAlert('danger', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏');
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ API –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:', error);
        showAlert('danger', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
function updatePerformanceDisplay(performance, isRealData) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    const totalTradesElement = document.querySelector('#performance .text-primary');
    const winRateElement = document.querySelector('#performance .text-success');
    
    if (totalTradesElement) totalTradesElement.textContent = performance.total_trades;
    if (winRateElement) winRateElement.textContent = performance.win_rate + '%';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    const performanceTab = document.getElementById('performance-tab');
    if (performanceTab && isRealData) {
        performanceTab.innerHTML = '<i class="fas fa-chart-line"></i> –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å <span class="badge bg-success ms-1">LIVE</span>';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∂–∏–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
function updateLiveChart(botId) {
    console.log('üìà –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∂–∏–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –±–æ—Ç–∞:', botId);
    
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chart.js
    showAlert('info', '–§—É–Ω–∫—Ü–∏—è –∂–∏–≤—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–∏
function manageTradingPairs(botId) {
    console.log('üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–∏ –¥–ª—è –±–æ—Ç–∞:', botId);
    
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä
    // –ü–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert
    alert(`–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–∏ –¥–ª—è –±–æ—Ç–∞ ${botId}\n\n–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.`);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
function toggleAutomation(botId, setting, enabled) {
    console.log(`ü§ñ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ${setting} –¥–ª—è –±–æ—Ç–∞ ${botId}:`, enabled);
    
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    fetch(`/api/bots/${botId}/automation`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            setting: setting,
            enabled: enabled
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log(`‚úÖ ${setting} ${enabled ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ'}`);
        } else {
            console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è ${setting}:`, data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ API –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:', error);
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞
window.refreshBotDetails = function() {
    const modalTitle = document.getElementById('botDetailsModalLabel').textContent;
    const botId = modalTitle.split(' ').pop();
    loadBotDetailsData(botId);
}

// –°—Ç–∞—Ä–∞—è —Å–ª–æ–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è showBotInfo —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
let consoleMonitoring = false;
let consoleInterval = null;
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
window.currentBotId = null;

function showConsoleOutput() {
    if (!currentBotId) {
        showAlert('warning', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Å–æ–ª–∏');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Å–æ–ª–∏
    const modal = new bootstrap.Modal(document.getElementById('consoleModal'));
    modal.show();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    document.getElementById('consoleModalLabel').innerHTML = 
        `<i class="fas fa-terminal"></i> –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –±–æ—Ç–∞ ${currentBotId}`;
    
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Å–æ–ª—å
    clearConsole();
}

function startConsoleMonitoring() {
    if (consoleMonitoring) {
        showAlert('info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
        return;
    }
    
    consoleMonitoring = true;
    addConsoleLine('üü¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω...', 'success');
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    consoleInterval = setInterval(() => {
        fetchConsoleLogs();
    }, 2000);
}

function pauseConsoleMonitoring() {
    if (!consoleMonitoring) {
        showAlert('info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∑–∞–ø—É—â–µ–Ω');
        return;
    }
    
    consoleMonitoring = false;
    if (consoleInterval) {
        clearInterval(consoleInterval);
        consoleInterval = null;
    }
    addConsoleLine('üü° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'warning');
}

function clearConsole() {
    document.getElementById('consoleOutput').innerHTML = '';
    addConsoleLine('üßπ –ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞', 'info');
}

function addConsoleLine(text, type = 'info') {
    const consoleOutput = document.getElementById('consoleOutput');
    const timestamp = new Date().toLocaleTimeString();
    
    let colorClass = '';
    switch(type) {
        case 'success': colorClass = 'text-success'; break;
        case 'warning': colorClass = 'text-warning'; break;
        case 'error': colorClass = 'text-danger'; break;
        case 'info': colorClass = 'text-info'; break;
        default: colorClass = 'text-light';
    }
    
    const line = document.createElement('div');
    line.className = `console-line ${colorClass}`;
    line.innerHTML = `[${timestamp}] ${text}`;
    
    consoleOutput.appendChild(line);
    
    // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
    const container = consoleOutput.parentElement;
    container.scrollTop = container.scrollHeight;
}

function fetchConsoleLogs() {
    if (!currentBotId) return;
    
    fetch(`/api/bots/${currentBotId}/logs/live`)
    .then(response => response.json())
    .then(data => {
            if (data.success && data.logs) {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
                data.logs.forEach(log => {
                    addConsoleLine(log, 'info');
                });
        }
    })
    .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤:', error);
        });
}

// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è forceStopAllBots —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ

window.showAlert = function(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    
    // –†–∞–∑–±–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const formattedMessage = message.replace(/\n/g, '<br>');
    
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            <div>${formattedMessage}</div>
    </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.container');
    container.insertBefore(alertDiv, container.firstChild);
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –∞–ª–µ—Ä—Ç—É
    alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 7000);
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
let refreshInterval = null;
let uptimeInterval = null;

// –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
let isRefreshing = false;

// –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', function() {
    if (refreshInterval) {
        clearInterval(refreshInterval);
    }
    if (uptimeInterval) {
        clearInterval(uptimeInterval);
    }
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
refreshInterval = setInterval(window.refreshBots, 30000);

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
let isModalOpen = false;

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–∞–º–∏
// –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç showBotDetails. –°–º. –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –Ω–∏–∂–µ.

window.startBot = function(botId) {
    console.log('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞:', botId);
    fetch(`/api/bots/${botId}/start`, { 
        method: 'POST',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω');
                window.updateBotsData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞:', data.error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: ' + data.error);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞');
        });
}

window.stopBot = function(botId) {
    console.log('‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞:', botId);
    fetch(`/api/bots/${botId}/stop`, { 
        method: 'POST',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                window.updateBotsData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:', data.error);
                alert('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞: ' + data.error);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞');
        });
}

// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è showCreateBotModal —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ

// –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
// –í—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è createBot —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –≤—ã—à–µ

window.refreshBots = function() {
    console.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤...');
    window.updateBotsData();
};

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±–æ—Ç–∞
window.deleteBot = function(botId) {
    console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –±–æ—Ç–∞:', botId);
    
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –±–æ—Ç–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        return;
    }
    
    fetch(`/api/bots/${botId}/delete`, {
        method: 'DELETE',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ –ë–æ—Ç —É–¥–∞–ª–µ–Ω');
                window.updateBotsData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                showAlert('success', '–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', data.error);
                showAlert('danger', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–æ—Ç–∞: ' + data.error);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞:', error);
            showAlert('danger', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–æ—Ç–∞');
        });
};

window.showBotInfo = function(botType) {
    console.log('‚ÑπÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ:', botType);
    
    const modal = new bootstrap.Modal(document.getElementById('botInfoModal'));
    const modalTitle = document.getElementById('botInfoModalLabel');
    const modalBody = document.getElementById('botInfoModalBody');
    
    if (modalTitle && modalBody) {
        modalTitle.textContent = botType === 'grid' ? 'Grid Bot' : 'Scalp Bot';
        
        const info = botType === 'grid' ? 
            `<h5>Grid Bot - –°–µ—Ç–æ—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</h5>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –ø–æ —Å–µ—Ç–∫–µ –æ—Ä–¥–µ—Ä–æ–≤</p>
            <p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong> –°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ –±–æ–∫–æ–≤–æ–º —Ä—ã–Ω–∫–µ</p>
            <p><strong>–†–∏—Å–∫–∏:</strong> –ù–∏–∑–∫–∏–µ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</p>
            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è:</strong> –ù–∞—á–∏–Ω–∞—é—â–∏—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤</p>` :
            `<h5>Scalp Bot - –°–∫–∞–ª—å–ø–∏–Ω–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</h5>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ë—ã—Å—Ç—Ä—ã–µ —Å–¥–µ–ª–∫–∏ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏—è—Ö</p>
            <p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong> –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–¥–µ–ª–æ–∫</p>
            <p><strong>–†–∏—Å–∫–∏:</strong> –°—Ä–µ–¥–Ω–∏–µ, —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è:</strong> –û–ø—ã—Ç–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤</p>`;
        
        modalBody.innerHTML = info;
    }
    
    modal.show();
}

window.forceStopAllBots = function() {
    console.log('‚èπÔ∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –±–æ—Ç–æ–≤...');
    
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã?')) {
        fetch('/api/bots/force-stop-all', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ –í—Å–µ –±–æ—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
                window.updateBotsData();
                showAlert('success', '–í—Å–µ –±–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:', data.error);
                showAlert('danger', '–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–æ–≤: ' + data.error);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞:', error);
            showAlert('danger', '–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–æ–≤');
        });
    }
}

window.showCreateBotModal = function() {
    console.log('‚ûï –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞');
    const modal = new bootstrap.Modal(document.getElementById('createBotModal'));
    modal.show();
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –≤—ã–∑—ã–≤–∞–µ–º updateBotsData()');
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π:');
    console.log('updateBotsData:', typeof window.updateBotsData);
    console.log('renderBotsList:', typeof window.renderBotsList);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if (typeof window.updateBotsData === 'function') {
        window.updateBotsData();
    } else {
        console.error('‚ùå –§—É–Ω–∫—Ü–∏—è updateBotsData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        console.log('‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
        const botsContainer = document.getElementById('bots-list');
        if (botsContainer && botsContainer.innerHTML.includes('spinner-border')) {
            console.log('‚ö†Ô∏è –°–ø–∏–Ω–Ω–µ—Ä –≤—Å–µ –µ—â–µ –∫—Ä—É—Ç–∏—Ç—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º...');
            window.updateBotsData();
        }
    }, 2000);
    
    const modal = document.getElementById('botDetailsModal');
    if (modal) {
        modal.addEventListener('show.bs.modal', function() {
            isModalOpen = true;
        });
        
        modal.addEventListener('hide.bs.modal', function() {
            isModalOpen = false;
            currentBotId = null;
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è aria-hidden
    const modals = ['createBotModal', 'botDetailsModal', 'exchangePairsModal'];
    
    modals.forEach(modalId => {
        const modalElement = document.getElementById(modalId);
        if (modalElement) {
            modalElement.addEventListener('show.bs.modal', function() {
                // –£–±–∏—Ä–∞–µ–º aria-hidden –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                modalElement.setAttribute('aria-hidden', 'false');
            });
            
            modalElement.addEventListener('hide.bs.modal', function() {
                // –î–æ–±–∞–≤–ª—è–µ–º aria-hidden –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                modalElement.setAttribute('aria-hidden', 'true');
            });
            
            modalElement.addEventListener('hidden.bs.modal', function() {
                // –£–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è
                const buttons = modalElement.querySelectorAll('button');
                buttons.forEach(button => {
                    if (button === document.activeElement) {
                        button.blur();
                    }
                });
            });
        }
    });
});

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ bot_id –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
// –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ currentBotId (–∏—Å–ø–æ–ª—å–∑—É–µ–º window.currentBotId)

window.showBotDetails = function(botId) {
    console.log('DEBUG: showBotDetails called with botId:', botId);
    currentBotId = botId;  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º currentBotId –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = new bootstrap.Modal(document.getElementById('botDetailsModal'));
    modal.show();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    document.getElementById('botDetailsModalLabel').textContent = `–î–µ—Ç–∞–ª–∏ –±–æ—Ç–∞ ${botId}`;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    window.loadBotDetails(botId);
};

window.loadBotDetails = function(botId) {
    console.log('DEBUG: loadBotDetails called with botId:', botId);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
    window.currentBotId = botId;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ
    if (!isModalOpen) {
        document.getElementById('botDetailsContent').innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...</p>
            </div>
        `;
    }
    
    console.log('DEBUG: Making API request to /api/bots/' + botId + '/details');
    fetch(`/api/bots/${botId}/details`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                renderBotDetails(data.bot || data.bot_details, data.charts, data.system_metrics, data.logs);
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã
                loadRecommendedPairs();
            } else {
                document.getElementById('botDetailsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>${data.error}</p>
                        </div>
                `;
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            document.getElementById('botDetailsContent').innerHTML = `
                <div class="alert alert-danger">
                    <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                    <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ.</p>
                        </div>
            `;
        });
};

// –í—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è renderBotDetails —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è —Å 4 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤—ã—à–µ

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω 
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω 
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
// HTML –∫–æ–¥ –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ renderBotDetails –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

function startUptimeUpdater() {
    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
    if (uptimeInterval) {
        clearInterval(uptimeInterval);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    uptimeInterval = setInterval(() => {
        const uptimeElement = document.querySelector('.text-primary');
        if (uptimeElement && uptimeElement.textContent.includes('–º–∏–Ω—É—Ç') || uptimeElement.textContent.includes('—á') || uptimeElement.textContent.includes('–¥')) {
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –±–æ—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
            const currentBotId = window.currentBotId;
            if (currentBotId) {
                loadBotDetails(currentBotId);
            }
        }
    }, 30000); // 30 —Å–µ–∫—É–Ω–¥
}

// –í—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è refreshBotDetails —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –≤—ã—à–µ

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–∏
let tradingPairs = [];
let botMode = 'base';
let totalCapital = 1000;
let exchangePairs = [];
let selectedExchangePairs = [];

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
// –í—Ç–æ—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ DOMContentLoaded —É–¥–∞–ª–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –≤—ã—à–µ

function loadSavedPairs() {
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã —Å –±–∏—Ä–∂–∏
        const savedSelected = localStorage.getItem('selectedTradingPairs');
        if (savedSelected) {
            selectedExchangePairs = JSON.parse(savedSelected);
            console.log('üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã:', selectedExchangePairs.length);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã
        const savedTrading = localStorage.getItem('tradingPairs');
        if (savedTrading) {
            tradingPairs = JSON.parse(savedTrading);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
            window.tradingPairs = tradingPairs;
            console.log('üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã:', tradingPairs.length);
            console.log('üìÅ –°–ø–∏—Å–æ–∫ –ø–∞—Ä:', tradingPairs);
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—Å—Ç—å
            if (typeof updateTradingPairsList === 'function' && document.getElementById('availablePairsList')) {
                updateTradingPairsList();
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (document.getElementById('capitalDistributionTable')) {
                updateCapitalDistribution();
            }
        } else {
            console.log('üìÅ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä');
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∂–∏–º –±–æ—Ç–∞
        const savedMode = localStorage.getItem('botMode');
        if (savedMode) {
            botMode = savedMode;
            console.log('üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω —Ä–µ–∂–∏–º –±–æ—Ç–∞:', botMode);
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            const modeSelect = document.getElementById('botModeSelect');
            if (modeSelect) {
                modeSelect.value = botMode;
            }
        } else {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            botMode = 'automatic';
            console.log('üìÅ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:', botMode);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª
        const savedCapital = localStorage.getItem('totalCapital');
        if (savedCapital) {
            totalCapital = parseFloat(savedCapital);
            console.log('üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω –æ–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª:', totalCapital);
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –∫–∞–ø–∏—Ç–∞–ª–∞ –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            const capitalInput = document.getElementById('totalCapital');
            if (capitalInput) {
                capitalInput.value = totalCapital;
            }
        }
    } catch (e) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä:', e);
        selectedExchangePairs = [];
        tradingPairs = [];
    }
}

function savePairs() {
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
        if (typeof selectedExchangePairs === 'undefined') {
            selectedExchangePairs = [];
        }
        if (typeof tradingPairs === 'undefined') {
            tradingPairs = [];
        }
        if (typeof botMode === 'undefined') {
            botMode = 'automatic';
        }
        if (typeof totalCapital === 'undefined') {
            totalCapital = 1000;
        }
        
        localStorage.setItem('selectedTradingPairs', JSON.stringify(selectedExchangePairs));
        localStorage.setItem('tradingPairs', JSON.stringify(tradingPairs));
        localStorage.setItem('botMode', botMode);
        localStorage.setItem('totalCapital', totalCapital.toString());
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
        window.tradingPairs = tradingPairs;
        
        console.log('üíæ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', selectedExchangePairs.length, '—Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä:', tradingPairs.length, '—Ä–µ–∂–∏–º:', botMode, '–∫–∞–ø–∏—Ç–∞–ª:', totalCapital);
    } catch (e) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
    }
}

function loadAvailableTradingPairs() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä
    fetch('/api/trading-pairs')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const pairs = data.pairs || [];
                const container = document.getElementById('availablePairsList');
                if (container) {
                    container.innerHTML = pairs.map(pair => `
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <code>${pair}</code>
                            <button class="btn btn-sm btn-outline-success" onclick="quickAddPair('${pair}')" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤–ª—é">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                        </div>
                    `).join('');
                } else {
                    console.warn('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä availablePairsList –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä:', error);
        });
}

function addTradingPair() {
    const input = document.getElementById('newTradingPair');
    if (!input) {
        console.error('‚ùå –ü–æ–ª–µ newTradingPair –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    const pair = input.value.trim().toUpperCase();
    
    if (!pair) {
        showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ tradingPairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
    if (!isValidTradingPair(pair)) {
        showAlert('danger', `‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä—ã: "${pair}"\n‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: BTC/USDT, ETH/USDT, SOL/USDT`);
        input.focus();
        input.select();
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ
    if (tradingPairs.includes(pair)) {
        showAlert('warning', `–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ ${pair} —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
        return;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä—É
    tradingPairs.push(pair);
    input.value = '';
    
    console.log('üìä –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞—Ä–∞:', pair);
    console.log('üìä –í—Å–µ–≥–æ –ø–∞—Ä:', tradingPairs.length);
    console.log('üìä –°–ø–∏—Å–æ–∫ –ø–∞—Ä:', tradingPairs);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    updateCapitalDistribution();
    updateTradingPairsList();
    savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
    showAlert('success', `–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ ${pair} –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
}

function quickAddPair(pair) {
    const input = document.getElementById('newTradingPair');
    if (!input) {
        console.error('‚ùå –ü–æ–ª–µ newTradingPair –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    input.value = pair;
    addTradingPair();
}

function removeTradingPair(pair) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É ${pair}?`)) {
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ tradingPairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    const index = tradingPairs.indexOf(pair);
    if (index > -1) {
        tradingPairs.splice(index, 1);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
        window.tradingPairs = tradingPairs;
        
        updateCapitalDistribution();
        updateTradingPairsList();
        savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        showAlert('success', `–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ ${pair} —É–¥–∞–ª–µ–Ω–∞`);
    }
}

function isValidTradingPair(pair) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç: –ë–ê–ó–û–í–ê–Ø_–í–ê–õ–Æ–¢–ê/–ö–û–¢–ò–†–û–í–û–ß–ù–ê–Ø_–í–ê–õ–Æ–¢–ê
    const pattern = /^[A-Z]{2,10}\/[A-Z]{2,10}$/;
    return pattern.test(pair);
}

// –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–∏
let userLimits = null;
let recommendedPairs = [];

async function loadRecommendedPairs() {
    try {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä...');
        
        const response = await fetch('/api/recommended-pairs');
        const data = await response.json();
        
        if (data.success) {
            recommendedPairs = data.recommended_pairs || [];
            userLimits = data.user_limits || {};
            
            console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä:', recommendedPairs.length);
            console.log('üìä –õ–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userLimits);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateRecommendedPairsList();
            updateUserLimitsDisplay();
            
            showAlert('success', `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${recommendedPairs.length} —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä`);
        } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä:', data.error);
            showAlert('danger', `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${data.error}`);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä:', error);
        showAlert('danger', `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
    }
}

function updateRecommendedPairsList() {
    const container = document.getElementById('availablePairsList');
    if (!container) {
        return;
    }
    
    if (recommendedPairs.length === 0) {
        container.innerHTML = '<div class="text-center text-muted py-3">–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä</div>';
        return;
    }
    
    container.innerHTML = recommendedPairs.map(pair => `
        <div class="list-group-item d-flex justify-content-between align-items-center">
            <div class="flex-grow-1">
                <code class="fw-bold">${pair.symbol}</code>
                <div class="small text-muted">
                    <span class="badge bg-${getRecommendationColor(pair.recommendation)} me-1">${pair.recommendation}</span>
                    <span class="badge bg-${getRiskColor(pair.risk_level)} me-1">${pair.risk_level}</span>
                    <span class="text-muted">Score: ${pair.smart_score}</span>
                </div>
            </div>
            <button class="btn btn-sm btn-outline-success" onclick="addRecommendedPair('${pair.symbol}')" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤–ª—é">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
        </div>
    `).join('');
}

function updateUserLimitsDisplay() {
    if (!userLimits) return;
    
    const limitInfo = document.getElementById('pairsLimitInfo');
    const limitsAlert = document.getElementById('userLimitsAlert');
    const limitsMessage = document.getElementById('limitsMessage');
    
    if (limitInfo) {
        limitInfo.textContent = `–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ ${userLimits.max_pairs} –ø–∞—Ä (–≤–∞—à–∞ —Ä–æ–ª—å: ${userLimits.user_role})`;
    }
    
    if (limitsAlert && limitsMessage) {
        if (userLimits.can_add_unlimited) {
            limitsAlert.className = 'alert alert-success alert-sm mt-2';
            limitsMessage.textContent = '–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω: –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä';
            limitsAlert.style.display = 'block';
        } else {
            limitsAlert.className = 'alert alert-info alert-sm mt-2';
            limitsMessage.textContent = `–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ª–∏–º–∏—Ç ${userLimits.max_pairs} –ø–∞—Ä`;
            limitsAlert.style.display = 'block';
        }
    }
}

async function addRecommendedPair(pair) {
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        const response = await fetch('/api/check-pair-addition', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                pair: pair,
                current_pairs: tradingPairs || []
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            if (data.can_add) {
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä—É
                if (typeof tradingPairs === 'undefined') {
                    tradingPairs = [];
                }
                
                tradingPairs.push(pair);
                updateCapitalDistribution();
                updateTradingPairsList();
                savePairs();
                
                showAlert('success', `–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ ${pair} –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
            } else {
                showAlert('warning', data.message);
            }
        } else {
            showAlert('danger', `–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${data.error}`);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—ã:', error);
        showAlert('danger', `–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${error.message}`);
    }
}

function getRecommendationColor(recommendation) {
    switch (recommendation) {
        case '–û—Ç–ª–∏—á–Ω–∞—è': return 'success';
        case '–•–æ—Ä–æ—à–∞—è': return 'primary';
        case '–°—Ä–µ–¥–Ω—è—è': return 'warning';
        default: return 'secondary';
    }
}

function getRiskColor(risk) {
    switch (risk) {
        case '–ù–∏–∑–∫–∏–π': return 'success';
        case '–°—Ä–µ–¥–Ω–∏–π': return 'warning';
        case '–í—ã—Å–æ–∫–∏–π': return 'danger';
        default: return 'secondary';
    }
}

function updateTradingPairsList() {
    const container = document.getElementById('availablePairsList');
    if (!container) {
        // –ù–µ –≤—ã–≤–æ–¥–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ tradingPairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    if (tradingPairs.length === 0) {
        container.innerHTML = '<div class="text-center text-muted py-3">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä</div>';
        return;
    }
    
    container.innerHTML = tradingPairs.map(pair => `
        <div class="list-group-item d-flex justify-content-between align-items-center">
            <code>${pair}</code>
            <button class="btn btn-sm btn-outline-danger" onclick="removeTradingPair('${pair}')" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ —Ç–æ—Ä–≥–æ–≤–ª–∏">
                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
            </button>
        </div>
    `).join('');
}

function updateCapitalDistribution() {
    const totalCapitalElement = document.getElementById('totalCapital');
    const total = totalCapitalElement ? parseFloat(totalCapitalElement.value) || 0 : 1000;
    const container = document.getElementById('capitalDistributionTable');
    
    if (!container) {
        console.warn('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä capitalDistributionTable –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ tradingPairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ botMode –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof botMode === 'undefined') {
        botMode = 'automatic';
    }
    
    if (tradingPairs.length === 0) {
        container.innerHTML = `
            <div class="text-center text-muted py-3">
                <i class="fas fa-chart-pie fa-2x mb-2"></i>
                <p>–ù–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                <small>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã –≤—ã—à–µ</small>
            </div>
        `;
        return;
    }
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∂–∏–º–∞
    console.log('üìä –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞:');
    console.log('üìä –ü–∞—Ä:', tradingPairs.length);
    console.log('üìä –†–µ–∂–∏–º:', botMode);
    console.log('üìä –ö–∞–ø–∏—Ç–∞–ª:', total);
    
    const distribution = calculateCapitalDistribution(tradingPairs, total, botMode);
    console.log('üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:', distribution);
    
    container.innerHTML = `
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞</th>
                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                        <th>–°—É–º–º–∞ (USDT)</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                </thead>
                <tbody>
                    ${Object.entries(distribution).map(([pair, info]) => `
                        <tr>
                            <td><strong>${pair}</strong></td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-${info.percentage > 30 ? 'success' : info.percentage > 15 ? 'warning' : 'info'}" 
                                         style="width: ${info.percentage}%">
                                        ${info.percentage.toFixed(1)}%
                                    </div>
                                </div>
                                    </td>
                            <td><strong>$${info.amount.toFixed(2)}</strong></td>
                            <td>
                                <span class="badge bg-${info.status === 'active' ? 'success' : 'secondary'}">
                                    ${info.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="togglePairStatus('${pair}')">
                                    <i class="fas fa-${info.status === 'active' ? 'pause' : 'play'}"></i>
                                        </button>
                                    </td>
                                </tr>
                    `).join('')}
                            </tbody>
                        </table>
                    </div>
        <div class="mt-3">
            <div class="row">
                <div class="col-md-6">
                    <small class="text-muted">
                        <strong>–û–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª:</strong> $${total.toFixed(2)}
                    </small>
                </div>
                <div class="col-md-6">
                    <small class="text-muted">
                        <strong>–†–µ–∂–∏–º:</strong> ${getModeDisplayName(botMode)}
                        ${botMode === 'automatic' ? `<br><strong>–¢–∏—Ä:</strong> ${getCapitalTier(total).name} (${getCapitalTier(total).pairs} –ø–∞—Ä)` : ''}
                    </small>
            </div>
        </div>
    </div>
    `;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    savePairs();
}

function calculateCapitalDistribution(pairs, totalCapital, mode) {
    const distribution = {};
    
    // –î–ª—è —Ä–µ–∂–∏–º–∞ automatic –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É
    if (mode === 'automatic') {
        return calculateAdaptiveDistribution(pairs, totalCapital);
    }
    
    const modeWeights = {
        'conservative': { base: 0.6, high: 0.3, low: 0.1 },
        'aggressive': { base: 0.3, high: 0.6, low: 0.1 }
    };
    
    const weights = modeWeights[mode] || modeWeights['conservative'];
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø–∞—Ä
    const pairPriorities = {};
    pairs.forEach((pair, index) => {
        if (pair.includes('BTC') || pair.includes('ETH')) {
            pairPriorities[pair] = 'high';
        } else if (pair.includes('USDT')) {
            pairPriorities[pair] = 'base';
    } else {
            pairPriorities[pair] = 'low';
        }
    });
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–ø–∏—Ç–∞–ª
    pairs.forEach(pair => {
        const priority = pairPriorities[pair];
        const percentage = weights[priority] * 100 / pairs.length;
        const amount = (totalCapital * percentage) / 100;
        
        distribution[pair] = {
            percentage: percentage,
            amount: amount,
            status: 'active',
            priority: priority
        };
    });
    
    return distribution;
}

function calculateAdaptiveDistribution(pairs, totalCapital) {
    const distribution = {};
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏—Ä –∫–∞–ø–∏—Ç–∞–ª–∞
    let tier = 'micro';
    let maxPairs = 1;
    let minCapitalPerPair = 200;
    
    if (totalCapital >= 5000) {
        tier = 'mega';
        maxPairs = 5;
        minCapitalPerPair = 200;
    } else if (totalCapital >= 3000) {
        tier = 'xlarge';
        maxPairs = 4;
        minCapitalPerPair = 200;
    } else if (totalCapital >= 1500) {
        tier = 'large';
        maxPairs = 3;
        minCapitalPerPair = 200;
    } else if (totalCapital >= 800) {
        tier = 'medium';
        maxPairs = 2;
        minCapitalPerPair = 200;
    } else if (totalCapital >= 400) {
        tier = 'small';
        maxPairs = 1;
        minCapitalPerPair = 300;
    } else {
        tier = 'micro';
        maxPairs = 1;
        minCapitalPerPair = 200;
    }
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä
    const pairsToUse = pairs.slice(0, maxPairs);
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–ø–∏—Ç–∞–ª —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
    const baseAllocation = totalCapital / pairsToUse.length;
    
    pairsToUse.forEach((pair, index) => {
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–π –ø–∞—Ä—ã (60/40)
        const allocation = index === 0 ? baseAllocation * 1.2 : baseAllocation * 0.8;
        const percentage = (allocation / totalCapital) * 100;
        
        distribution[pair] = {
            percentage: percentage,
            amount: allocation,
            status: 'active',
            priority: index === 0 ? 'high' : 'base',
            tier: tier
        };
    });
    
    return distribution;
}

function determineModeByBalance(balance) {
    // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞
    if (balance < 100) {
        return 'conservative';  // –ú–∞–ª—ã–π –±–∞–ª–∞–Ω—Å - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    } else if (balance < 1000) {
        return 'base';          // –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å - –±–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º
    } else if (balance < 10000) {
        return 'aggressive';    // –ë–æ–ª—å—à–æ–π –±–∞–ª–∞–Ω—Å - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    } else {
        return 'aggressive';    // –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –±–∞–ª–∞–Ω—Å - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    }
}

function getModeDisplayName(mode) {
    const names = {
        'automatic': 'ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)',
        'conservative': 'üõ°Ô∏è –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π',
        'aggressive': '‚ö° –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π'
    };
    return names[mode] || mode;
}

window.changeBotMode = function() {
    const modeSelect = document.getElementById('botModeSelect');
    if (!modeSelect) {
        console.error('‚ùå –°–µ–ª–µ–∫—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    botMode = modeSelect.value;
    console.log('üîÑ –†–µ–∂–∏–º –±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:', botMode);
    
    // –î–ª—è —Ä–µ–∂–∏–º–∞ automatic –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
    if (botMode === 'automatic') {
        getRealBalanceAndUpdate();
    } else {
        // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
        const totalCapitalInput = document.getElementById('totalCapital');
        if (totalCapitalInput) {
            totalCapitalInput.disabled = false;
            totalCapitalInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª';
        }
    }
    
    updateCapitalDistribution();
    savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    showAlert('info', `–†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${getModeDisplayName(botMode)}`);
}

function getRealBalanceAndUpdate() {
    console.log('üîÑ –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å –±–∏—Ä–∂–∏...');
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å –±–∏—Ä–∂–∏
    fetch('/api/balance')
        .then(response => response.json())
        .then(data => {
            console.log('üìä –û—Ç–≤–µ—Ç API –±–∞–ª–∞–Ω—Å–∞:', data);
            
            if (data.success && data.balance && data.balance.length > 0) {
                // –ò—â–µ–º USDT –±–∞–ª–∞–Ω—Å –≤ –º–∞—Å—Å–∏–≤–µ
                let totalBalance = 0;
                for (let balanceInfo of data.balance) {
                    if (balanceInfo.balance && balanceInfo.balance.USDT) {
                        totalBalance += parseFloat(balanceInfo.balance.USDT);
                    }
                }
                
                // –ï—Å–ª–∏ USDT –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
                if (totalBalance === 0 && data.balance.length > 0) {
                    const firstBalance = data.balance[0].balance;
                    for (let currency in firstBalance) {
                        const amount = parseFloat(firstBalance[currency]);
                        if (amount > 0) {
                            totalBalance = amount;
                            console.log(`üí∞ –ò—Å–ø–æ–ª—å–∑—É–µ–º ${currency} –±–∞–ª–∞–Ω—Å: ${amount}`);
                            break;
                        }
                    }
                }
                
                console.log('üí∞ –û–±—â–∏–π –±–∞–ª–∞–Ω—Å:', totalBalance);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –±–∞–ª–∞–Ω—Å–∞
                const totalCapitalInput = document.getElementById('totalCapital');
                if (totalCapitalInput) {
                    totalCapitalInput.value = totalBalance.toFixed(2);
                    totalCapitalInput.disabled = true;
                    totalCapitalInput.placeholder = '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–µ–Ω —Å –±–∏—Ä–∂–∏';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                    totalCapital = totalBalance;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏—Ä–µ
                    const tier = getCapitalTier(totalBalance);
                    showAlert('info', `ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: ${tier.name} (–±–∞–ª–∞–Ω—Å: $${totalBalance.toFixed(2)}) - ${tier.pairs} –ø–∞—Ä, –º–∏–Ω–∏–º—É–º $${tier.minCapital} –Ω–∞ –ø–∞—Ä—É`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                    updateCapitalDistribution();
                    savePairs();
                }
            } else {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —Å –±–∏—Ä–∂–∏:', data);
                
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ –ª–æ–≥–æ–≤ –±–æ—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                let fallbackBalance = 1471.28; // –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
                
                showAlert('warning', `–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —Å –±–∏—Ä–∂–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: $${fallbackBalance}`);
                const totalCapitalInput = document.getElementById('totalCapital');
                if (totalCapitalInput) {
                    totalCapitalInput.value = fallbackBalance.toFixed(2);
                    totalCapitalInput.disabled = true;
                    totalCapitalInput.placeholder = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                    totalCapital = fallbackBalance;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏—Ä–µ
                    const tier = getCapitalTier(fallbackBalance);
                    showAlert('info', `ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: ${tier.name} (–±–∞–ª–∞–Ω—Å: $${fallbackBalance.toFixed(2)}) - ${tier.pairs} –ø–∞—Ä, –º–∏–Ω–∏–º—É–º $${tier.minCapital} –Ω–∞ –ø–∞—Ä—É`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                    updateCapitalDistribution();
                    savePairs();
                }
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            let fallbackBalance = 1471.28; // –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
            
            showAlert('warning', `–û—à–∏–±–∫–∞ API. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: $${fallbackBalance}`);
            const totalCapitalInput = document.getElementById('totalCapital');
            if (totalCapitalInput) {
                totalCapitalInput.value = fallbackBalance.toFixed(2);
                totalCapitalInput.disabled = true;
                totalCapitalInput.placeholder = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                totalCapital = fallbackBalance;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏—Ä–µ
                const tier = getCapitalTier(fallbackBalance);
                showAlert('info', `ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: ${tier.name} (–±–∞–ª–∞–Ω—Å: $${fallbackBalance.toFixed(2)}) - ${tier.pairs} –ø–∞—Ä, –º–∏–Ω–∏–º—É–º $${tier.minCapital} –Ω–∞ –ø–∞—Ä—É`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                updateCapitalDistribution();
                savePairs();
            }
        });
}

function autoUpdateMode() {
    // –î–ª—è —Ä–µ–∂–∏–º–∞ automatic –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏—Ä–µ –∫–∞–ø–∏—Ç–∞–ª–∞
    if (botMode === 'automatic') {
        const totalCapitalInput = document.getElementById('totalCapital');
        if (!totalCapitalInput) {
            console.error('‚ùå –ü–æ–ª–µ totalCapital –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        
        const balance = parseFloat(totalCapitalInput.value) || 0;
        const tier = getCapitalTier(balance);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        updateCapitalDistribution();
        savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–∏—Ä–µ
        showAlert('info', `ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: ${tier.name} (–±–∞–ª–∞–Ω—Å: $${balance.toFixed(2)}) - ${tier.pairs} –ø–∞—Ä, –º–∏–Ω–∏–º—É–º $${tier.minCapital} –Ω–∞ –ø–∞—Ä—É`);
    }
}

function calculateUptime(botDetails) {
    if (!botDetails) return '0 –º–∏–Ω—É—Ç';
    
    // –ï—Å–ª–∏ –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 0
    if (botDetails.status !== 'running') {
        return '0 –º–∏–Ω—É—Ç';
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å
    if (botDetails.started_at) {
        const startTime = new Date(botDetails.started_at);
        const now = new Date();
        const diffMs = now - startTime;
        const diffMinutes = Math.floor(diffMs / (1000 * 60));
        
        if (diffMinutes < 60) {
            return `${diffMinutes} –º–∏–Ω—É—Ç`;
        } else if (diffMinutes < 1440) { // –º–µ–Ω—å—à–µ —Å—É—Ç–æ–∫
            const hours = Math.floor(diffMinutes / 60);
            const minutes = diffMinutes % 60;
            return `${hours}—á ${minutes}–º`;
        } else {
            const days = Math.floor(diffMinutes / 1440);
            const hours = Math.floor((diffMinutes % 1440) / 60);
            return `${days}–¥ ${hours}—á`;
        }
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å uptime –≤ runtime_info, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    if (botDetails.runtime_info?.uptime) {
        return botDetails.runtime_info.uptime;
    }
    
    return '0 –º–∏–Ω—É—Ç';
}

function getCapitalTier(balance) {
    if (balance >= 5000) {
        return { name: 'Mega', pairs: 8, minCapital: 200 };
    } else if (balance >= 3000) {
        return { name: 'XLarge', pairs: 6, minCapital: 200 };
    } else if (balance >= 1500) {
        return { name: 'Large', pairs: 5, minCapital: 200 };
    } else if (balance >= 800) {
        return { name: 'Medium', pairs: 4, minCapital: 200 };
    } else if (balance >= 400) {
        return { name: 'Small', pairs: 3, minCapital: 200 };
        } else {
        return { name: 'Micro', pairs: 2, minCapital: 200 };
    }
}

function togglePairStatus(pair) {
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—ã
    showAlert('info', `–°—Ç–∞—Ç—É—Å –ø–∞—Ä—ã ${pair} –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω`);
    updateCapitalDistribution();
    savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
}

window.updateBotSettings = function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ tradingPairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    const totalCapitalInput = document.getElementById('totalCapital');
    if (!totalCapitalInput) {
        console.error('‚ùå –ü–æ–ª–µ totalCapital –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    totalCapital = parseFloat(totalCapitalInput.value);
    
    const settings = {
        mode: botMode,
        total_capital: totalCapital,
        trading_pairs: tradingPairs
    };
    
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞:', settings);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    fetch(`/api/bots/${currentBotId}/settings`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings)
    })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
            savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage
            showAlert('success', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                } else {
            showAlert('danger', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + data.error);
                }
            })
            .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showAlert('danger', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–∞–º–∏ —Å –±–∏—Ä–∂–∏
function loadExchangePairs() {
    console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä—ã —Å –±–∏—Ä–∂–∏...');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modalElement = document.getElementById('exchangePairsModal');
    if (!modalElement) {
        console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ exchangePairsModal –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä—ã —Å –±–∏—Ä–∂–∏
    fetch('/api/exchange-pairs', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        },
        credentials: 'same-origin'  // –í–∫–ª—é—á–∞–µ–º cookies –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    })
        .then(response => {
            console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
            console.log('üì° –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', response.headers);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
            .then(data => {
            console.log('üìä –î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
                if (data.success) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ exchangePairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
                if (typeof exchangePairs === 'undefined') {
                    exchangePairs = [];
                }
                
                exchangePairs = data.pairs || [];
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${exchangePairs.length} –ø–∞—Ä`);
                displayExchangePairs();
                savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
                if (data.note) {
                    showAlert('info', data.note);
                }
                } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                showAlert('danger', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä —Å –±–∏—Ä–∂–∏: ' + data.error);
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modalElement = document.getElementById('exchangePairsModal');
                if (modalElement) {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                }
                }
            })
            .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä:', error);
            console.error('‚ùå –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error);
            showAlert('danger', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä —Å –±–∏—Ä–∂–∏: ' + error.message);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modalElement = document.getElementById('exchangePairsModal');
            if (modalElement) {
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                }
            }
        });
}

function displayExchangePairs() {
    const container = document.getElementById('exchangePairsList');
    if (!container) {
        console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä exchangePairsList –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ exchangePairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof exchangePairs === 'undefined') {
        exchangePairs = [];
    }
    
    if (exchangePairs.length === 0) {
        container.innerHTML = '<div class="text-center text-muted py-3">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞—Ä</div>';
        return;
    }
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ USDT –ø–∞—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
    const usdtPairs = exchangePairs
        .filter(pair => pair.includes('/USDT'))
        .sort((a, b) => {
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–∞—Ä
            const popular = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'ADA/USDT', 'SOL/USDT'];
            const aIndex = popular.indexOf(a);
            const bIndex = popular.indexOf(b);
            if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
            if (aIndex !== -1) return -1;
            if (bIndex !== -1) return 1;
            return a.localeCompare(b);
        });
    
    container.innerHTML = usdtPairs.map(pair => `
        <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" value="${pair}" 
                   id="pair_${pair.replace('/', '_')}" onchange="togglePairSelection('${pair}')">
            <label class="form-check-label" for="pair_${pair.replace('/', '_')}">
                <code>${pair}</code>
                <span class="badge bg-secondary ms-2">USDT</span>
            </label>
        </div>
    `).join('');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    savePairs();
}

function togglePairSelection(pair) {
    const checkbox = document.getElementById(`pair_${pair.replace('/', '_')}`);
    if (!checkbox) {
        console.error('‚ùå –ß–µ–∫–±–æ–∫—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ø–∞—Ä—ã:', pair);
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ selectedExchangePairs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof selectedExchangePairs === 'undefined') {
        selectedExchangePairs = [];
    }
    
    if (checkbox.checked) {
        if (!selectedExchangePairs.includes(pair)) {
            selectedExchangePairs.push(pair);
        }
    } else {
        const index = selectedExchangePairs.indexOf(pair);
        if (index > -1) {
            selectedExchangePairs.splice(index, 1);
        }
    }
    savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
}

function filterExchangePairs() {
    const searchInput = document.getElementById('pairSearch');
    if (!searchInput) {
        console.error('‚ùå –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ pairSearch –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        return;
    }
    
    const searchTerm = searchInput.value.toLowerCase();
    const checkboxes = document.querySelectorAll('#exchangePairsList .form-check');
    
    checkboxes.forEach(checkbox => {
        const pair = checkbox.querySelector('code').textContent.toLowerCase();
        if (pair.includes(searchTerm)) {
            checkbox.style.display = 'block';
        } else {
            checkbox.style.display = 'none';
        }
    });
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    savePairs();
}

function addSelectedPairs() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
    if (typeof selectedExchangePairs === 'undefined') {
        selectedExchangePairs = [];
    }
    if (typeof tradingPairs === 'undefined') {
        tradingPairs = [];
    }
    
    if (selectedExchangePairs.length === 0) {
        showAlert('warning', '–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
        return;
    }
    
    let addedCount = 0;
    selectedExchangePairs.forEach(pair => {
        if (!tradingPairs.includes(pair)) {
            tradingPairs.push(pair);
            addedCount++;
        }
    });
    
    if (addedCount > 0) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
        window.tradingPairs = tradingPairs;
        
        updateCapitalDistribution();
        updateTradingPairsList();
        savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        showAlert('success', `–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä`);
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modalElement = document.getElementById('exchangePairsModal');
        if (modalElement) {
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) {
                modal.hide();
            }
        }
        
        // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä
        selectedExchangePairs = [];
        savePairs(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        
        // –°–Ω–∏–º–∞–µ–º –≥–∞–ª–æ—á–∫–∏ —Å —á–µ–∫–±–æ–∫—Å–æ–≤
        const checkboxes = document.querySelectorAll('#exchangePairsList input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.checked = false;
        });
    } else {
        showAlert('warning', '–í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
function createPerformanceChart() {
    const ctx = document.getElementById('performanceChart');
    if (!ctx) return;
    
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
            datasets: [{
                label: '–ü—Ä–∏–±—ã–ª—å (%)',
                data: [0, 1.2, 2.8, 1.5, 3.2, 4.1, 5.3],
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.4
            }, {
                label: '–û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤',
                data: [0, 0.8, 1.5, 2.1, 1.8, 2.5, 3.2],
                borderColor: 'rgb(255, 99, 132)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞ 24 —á–∞—Å–∞'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function createMarketAnalysisChart() {
    const ctx = document.getElementById('marketAnalysisChart');
    if (!ctx) return;
    
    // –ü–æ–ª—É—á–∞–µ–º –¢–û–õ–¨–ö–û –≤–∞—à–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    let tradingPairs = [];
    
    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞
    if (typeof window.currentBotPairs !== 'undefined' && window.currentBotPairs.length > 0) {
        tradingPairs = window.currentBotPairs;
    } else if (typeof window.tradingPairs !== 'undefined' && window.tradingPairs.length > 0) {
        tradingPairs = window.tradingPairs;
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (tradingPairs.length === 0) {
        console.log('üìä –ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
        // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        const ctx = document.getElementById('marketAnalysisChart');
        if (ctx) {
            ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
            const ctx2d = ctx.getContext('2d');
            ctx2d.font = '16px Arial';
            ctx2d.fillStyle = '#666';
            ctx2d.textAlign = 'center';
            ctx2d.fillText('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', ctx.width/2, ctx.height/2);
        }
        return;
    }
    
    const currentPair = tradingPairs[Math.floor(Math.random() * tradingPairs.length)];
    
    // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    const volatility = Math.random() * 40 + 30; // 30-70%
    const liquidity = Math.random() * 30 + 70;  // 70-100%
    const trend = Math.random() * 60 + 20;      // 20-80%
    const rsi = Math.random() * 40 + 30;        // 30-70%
    const volume = Math.random() * 50 + 40;     // 40-90%
    const risk = Math.random() * 30 + 20;       // 20-50%
    
    const chart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å', '–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å', '–¢—Ä–µ–Ω–¥', 'RSI', '–û–±—ä–µ–º', '–†–∏—Å–∫'],
            datasets: [{
                label: `–ê–Ω–∞–ª–∏–∑ ${currentPair}`,
                data: [volatility, liquidity, trend, rsi, volume, risk],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: `–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π - ${currentPair} (${tradingPairs.length} –ø–∞—Ä)`,
                    font: {
                        size: 14,
                        weight: 'bold'
                    }
                },
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed.r;
                            let description = '';
                            
                            switch(label) {
                                case '–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å':
                                    description = value > 60 ? '–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!' : 
                                                 value > 40 ? '–£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å' : '–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Å—Ç–∞–±–∏–ª—å–Ω–æ';
                                    break;
                                case '–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å':
                                    description = value > 80 ? '–û—Ç–ª–∏—á–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å' : 
                                                 value > 60 ? '–•–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å' : '–ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å';
                                    break;
                                case '–¢—Ä–µ–Ω–¥':
                                    description = value > 60 ? '–°–∏–ª—å–Ω—ã–π –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥' : 
                                                 value > 40 ? '–°–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥' : '–ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥';
                                    break;
                                case 'RSI':
                                    description = value > 70 ? '–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å' : 
                                                 value < 30 ? '–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å' : '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞';
                                    break;
                                case '–û–±—ä–µ–º':
                                    description = value > 70 ? '–í—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤' : 
                                                 value > 50 ? '–°—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º' : '–ù–∏–∑–∫–∏–π –æ–±—ä–µ–º';
                                    break;
                                case '–†–∏—Å–∫':
                                    description = value > 40 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : 
                                                 value > 25 ? '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
                                    break;
                            }
                            
                            return `${label}: ${value.toFixed(1)}% - ${description}`;
                        }
                    }
                }
            },
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        stepSize: 20,
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            onClick: function(event, elements) {
                console.log('Chart clicked!', event, elements);
                showPairSelectionModal(tradingPairs, {
                    volatility: volatility,
                    liquidity: liquidity,
                    trend: trend,
                    rsi: rsi,
                    volume: volume,
                    risk: risk
                });
            }
        }
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—É
    ctx.style.cursor = 'pointer';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–∏–∞–≥—Ä–∞–º–º—ã
    const chartContainer = ctx.parentElement;
    if (chartContainer) {
        chartContainer.style.cursor = 'pointer';
        chartContainer.addEventListener('click', function(e) {
            console.log('Chart container clicked!');
            showPairSelectionModal(tradingPairs, {
                volatility: volatility,
                liquidity: liquidity,
                trend: trend,
                rsi: rsi,
                volume: volume,
                risk: risk
            });
        });
    }
}

function showPairSelectionModal(pairs, data) {
    const modalHtml = `
        <div class="modal fade" id="pairSelectionModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-chart-line"></i> –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞ (–¥–æ—Å—Ç—É–ø–Ω–æ ${pairs.length} –ø–∞—Ä):</p>
                        <div class="list-group">
                            ${pairs.map(pair => `
                                <button type="button" class="list-group-item list-group-item-action" onclick="analyzePair('${pair}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${pair}</h6>
                                        <small class="text-muted">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</small>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
    const existingModal = document.getElementById('pairSelectionModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–æ–¥–∞–ª
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
    const modal = new bootstrap.Modal(document.getElementById('pairSelectionModal'));
    modal.show();
}

function analyzePair(pair, data) {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª –≤—ã–±–æ—Ä–∞
    const selectionModal = bootstrap.Modal.getInstance(document.getElementById('pairSelectionModal'));
    if (selectionModal) {
        selectionModal.hide();
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    showMarketAnalysisDetails(pair, data);
}

function showMarketAnalysisDetails(pair, data) {
    const modalHtml = `
        <div class="modal fade" id="marketAnalysisModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-chart-line"></i> –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ - ${pair}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-wind text-warning"></i> –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: ${data.volatility.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.volatility > 60 ? '‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Ä—ã–Ω–æ–∫ –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω, –≤–æ–∑–º–æ–∂–Ω—ã —Ä–µ–∑–∫–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã' : 
                                      data.volatility > 40 ? '‚úÖ –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏' : 
                                      'üõ°Ô∏è –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫, –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫'}
                                </p>
                                
                                <h6><i class="fas fa-tint text-primary"></i> –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: ${data.liquidity.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.liquidity > 80 ? 'üíé –û—Ç–ª–∏—á–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –±—ã—Å—Ç—Ä—ã–µ —Å–¥–µ–ª–∫–∏, —É–∑–∫–∏–µ —Å–ø—Ä–µ–¥—ã' : 
                                      data.liquidity > 60 ? '‚úÖ –•–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏' : 
                                      '‚ö†Ô∏è –ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤'}
                                </p>
                                
                                <h6><i class="fas fa-trending-up text-success"></i> –¢—Ä–µ–Ω–¥: ${data.trend.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.trend > 60 ? 'üìà –°–∏–ª—å–Ω—ã–π –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–æ–∫' : 
                                      data.trend > 40 ? '‚û°Ô∏è –°–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥ - –±–æ–∫–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ' : 
                                      'üìâ –ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –ø–æ–∫—É–ø–∫–∞–º–∏'}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-chart-area text-info"></i> RSI: ${data.rsi.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.rsi > 70 ? 'üî¥ –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å - –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–Ω–∏–∑' : 
                                      data.rsi < 30 ? 'üü¢ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å - –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç—Å–∫–æ–∫ –≤–≤–µ—Ä—Ö' : 
                                      '‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è'}
                                </p>
                                
                                <h6><i class="fas fa-chart-bar text-warning"></i> –û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤: ${data.volume.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.volume > 70 ? 'üî• –í—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º - –∞–∫—Ç–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞' : 
                                      data.volume > 50 ? '‚úÖ –°—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º - –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å' : 
                                      'üò¥ –ù–∏–∑–∫–∏–π –æ–±—ä–µ–º - —Å–ª–∞–±—ã–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ø–∞—Ä–µ'}
                                </p>
                                
                                <h6><i class="fas fa-shield-alt text-danger"></i> –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: ${data.risk.toFixed(1)}%</h6>
                                <p class="small text-muted">
                                    ${data.risk > 40 ? 'üö® –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å—ã' : 
                                      data.risk > 25 ? '‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫ - —Ç–æ—Ä–≥—É–π—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ' : 
                                      '‚úÖ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è'}
                                </p>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="alert alert-info">
                            <h6><i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è ${pair}:</h6>
                            <ul class="mb-0">
                                ${getTradingRecommendations(data).map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                        <button type="button" class="btn btn-primary" onclick="refreshMarketAnalysis()">
                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
    const existingModal = document.getElementById('marketAnalysisModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–æ–¥–∞–ª
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
    const modal = new bootstrap.Modal(document.getElementById('marketAnalysisModal'));
    modal.show();
}

function getTradingRecommendations(data) {
    const recommendations = [];
    
    if (data.volatility > 60) {
        recommendations.push('‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–∏–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π');
    }
    
    if (data.liquidity < 60) {
        recommendations.push('üíß –ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –∏–∑–±–µ–≥–∞–π—Ç–µ –∫—Ä—É–ø–Ω—ã—Ö —Å–¥–µ–ª–æ–∫');
    }
    
    if (data.trend > 60) {
        recommendations.push('üìà –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ - —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–∫—É–ø–∫–∏ –Ω–∞ –æ—Ç–∫–∞—Ç–∞—Ö');
    } else if (data.trend < 40) {
        recommendations.push('üìâ –ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –ø–æ–∫—É–ø–∫–∞–º–∏');
    }
    
    if (data.rsi > 70) {
        recommendations.push('üî¥ RSI –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω - –∂–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–ª—è –≤—Ö–æ–¥–∞');
    } else if (data.rsi < 30) {
        recommendations.push('üü¢ RSI –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω - –≤–æ–∑–º–æ–∂–Ω–∞ —Ö–æ—Ä–æ—à–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞');
    }
    
    if (data.volume < 50) {
        recommendations.push('üò¥ –ù–∏–∑–∫–∏–π –æ–±—ä–µ–º - —Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–º');
    }
    
    if (data.risk > 40) {
        recommendations.push('üõ°Ô∏è –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å—ã');
    }
    
    if (recommendations.length === 0) {
        recommendations.push('‚úÖ –£—Å–ª–æ–≤–∏—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã');
    }
    
    return recommendations;
}

function refreshMarketAnalysis() {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–æ–¥–∞–ª
    const modal = bootstrap.Modal.getInstance(document.getElementById('marketAnalysisModal'));
    if (modal) {
        modal.hide();
    }
    
    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É
    setTimeout(() => {
        createMarketAnalysisChart();
    }, 300);
}
// –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã ‚Äî –æ–Ω–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏)
}
}
</script>
    <!-- bots.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ, –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
    <script src="{{ url_for('static', filename='js/bots.js') }}"></script>
{% endblock %}
