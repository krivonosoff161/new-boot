<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏ - –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .bot-card { transition: transform 0.2s; }
        .bot-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                üöÄ –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    –ü—Ä–∏–≤–µ—Ç, {{ username }}! ({{ role }})
                </span>
                <a class="nav-link" href="/dashboard">–î–∞—à–±–æ—Ä–¥</a>
                <a class="nav-link" href="/logout">–í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center text-primary">
                    <i class="fas fa-robot"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
                </h1>
            </div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞</h5>
                    </div>
                    <div class="card-body">
                        <form id="createBotForm">
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞</label>
                                    <input type="text" class="form-control" id="botName" placeholder="–ú–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">–¢–∏–ø –±–æ—Ç–∞</label>
                                    <select class="form-select" id="botType" required>
                                        <option value="grid">Grid Bot</option>
                                        <option value="dca">DCA Bot</option>
                                        <option value="scalping">Scalping Bot</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> –ú–æ–∏ –±–æ—Ç—ã</h5>
                    </div>
                    <div class="card-body" id="botsList">
                        {% if bots %}
                            <div class="row">
                                {% for bot in bots %}
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="card bot-card">
                                        <div class="card-body">
                                            <h6 class="card-title">{{ bot.name }}</h6>
                                            <p class="card-text">
                                                <span class="badge bg-{{ 'success' if bot.status == 'running' else 'warning' if bot.status == 'stopped' else 'secondary' }}">
                                                    {{ bot.status }}
                                                </span>
                                                <br>
                                                <small class="text-muted">{{ bot.type }}</small>
                                            </p>
                                            <div class="btn-group w-100" role="group">
                                                {% if bot.status == 'running' %}
                                                    <button class="btn btn-warning btn-sm" onclick="stopBot('{{ bot.id }}')">
                                                        <i class="fas fa-stop"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                                    </button>
                                                {% elif bot.status == 'stopped' %}
                                                    <button class="btn btn-success btn-sm" onclick="startBot('{{ bot.id }}')">
                                                        <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
                                                    </button>
                                                {% endif %}
                                                <button class="btn btn-danger btn-sm" onclick="deleteBot('{{ bot.id }}')">
                                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </div>
                                            <small class="text-muted d-block mt-2">
                                                –°–æ–∑–¥–∞–Ω: {{ bot.created_at[:10] }}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center text-muted">
                                <i class="fas fa-robot fa-3x mb-3"></i>
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–æ—Ç–æ–≤</p>
                                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º—ã –≤—ã—à–µ</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
        document.getElementById('createBotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const botName = document.getElementById('botName').value;
            const botType = document.getElementById('botType').value;
            
            fetch('/api/bots/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: botName,
                    type: botType
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ë–æ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞: ' + data.error);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞');
            });
        });

        // –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
        function startBot(botId) {
            fetch(`/api/bots/${botId}/start`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: ' + data.error);
                }
            });
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
        function stopBot(botId) {
            fetch(`/api/bots/${botId}/stop`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞: ' + data.error);
                }
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞
        function deleteBot(botId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –±–æ—Ç–∞?')) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –±–æ—Ç–∞
                alert('–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
            }
        }
    </script>
</body>
</html>
